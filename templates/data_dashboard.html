{% extends "base.html" %}
{% block content %}

<div class="dashboard-container">
    <h1 class="dashboard-title">Data Dashboard</h1>
    
    <div class="grid-dashboard">
        
        <!--ID data -->
        <section class="data-card">
            <h2>User ID Metrics</h2>
            <div class="metric"><strong>Total Swipes:</strong> {{ total_student_count }}</div>
            <div class="metric"><strong>Distinct Users:</strong> {{ distinct_student_count }}</div>
            <div class="metric"><strong>Avg Visits/User:</strong> {{ avg_visits_per_user }}</div>
        </section>

        <!-- food poundage -->
        <section class="data-card">
            <h2>Food Distribution</h2>
            <div class="metric"><strong>Total Lbs Distributed:</strong> {{ total_pounds_taken }}</div>
            <div class="metric"><strong>Avg Lbs/Day:</strong> {{ avg_lbs_per_day  }}</div>
        </section>

        <!-- timestamp data -->
        <section class="data-card">
            <h2>Visit Timing</h2>
            <div class="metric"><strong>Most Visited Day:</strong> {{ most_visited_day }}</div>
            <div class="metric"><strong>Avg Visits/Day:</strong> {{ avg_visits_per_day }}</div>
            <div class="metric"><strong>Peak Daily Visits:</strong> {{ highest_num_of_visits }}</div>
        </section>

        <!-- clothing data -->
        <section class="data-card">
            <h2>Clothing Info</h2>
            <div class="metric"><strong>Total Items Taken:</strong> {{total_clothes_taken | int}}</div>
        </section>

        <div class="chart">
            <h2>Food and Clothes for Days</h2>
            <canvas id="myChart" width="500px"></canvas>
        </div>

    </div>

    <!--download button -->
    <div class="download-section">
        <form action="{{ url_for('download_csv') }}" method="get">
            <button type="submit" class="download-btn">⬇️ Download CSV</button>
        </form>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  const poundsData = {{ pounds_per_day | tojson }}; 
  const labels = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'];
  const dataValues = labels.map(day => poundsData[day] || 0);

  //const ctx = document.getElementById('myChart').getContext('2d');

  new Chart(document.getElementById('myChart'), {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Pounds Taken',
          data: dataValues,
          backgroundColor: 'rgba(75, 192, 192, 0.6)',
          borderColor: 'rgba(75, 192, 192, 1)',
          borderWidth: 1
        }
      ]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
</script>

{% endblock %}